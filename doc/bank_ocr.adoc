= Bank OCR
:toc:
:sectnums:
:toclevels: 5
ifndef::env-github[:icons: font]
ifdef::env-github[]
:status:
:stem:
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]
:source-highlighter: highlightjs
:figure-caption: Figure 
:table-caption: Table 
:imagesdir: ./image

https://codingdojo.org/kata/BankOCR/[Bank OCR]

== 問題の説明

=== ユーザー・ストーリー 1

あなたは銀行に勤務しており、その銀行では最近、支店から送られてくる手紙やファックスを読み取るための巧妙な機械を導入しました。この機械は紙の文書をスキャンし、以下のような形式のエントリを多数含むファイルを生成します。

[source, txt]
----
    _  _     _  _  _  _  _ 
  | _| _||_||_ |_   ||_||_|
  ||_  _|  | _||_|  ||_| _|

----

各エントリは4行で構成され、各行は27文字です。最初の3行には、パイプとアンダースコアを使って書かれた口座番号が含まれており、4行目は空白行です。各口座番号は0から9の範囲の9桁の数字で構成されている必要があります。通常のファイルには、約500件のエントリが含まれています。

あなたの最初のタスクは、このファイルを受け取って実際の口座番号にパースするプログラムを書くことです。

=== ユーザー・ストーリー 2

これを実装してすぐに、あなたはこの巧妙な機械が実は完全無欠ではないことに気づきます。スキャン時に時々エラーが発生するのです。したがって、次のステップは、読み取った番号が実際に有効な口座番号であるかを検証することです。有効な口座番号は、有効なチェックサムを持っています。チェックサムは次のように計算できます。

口座番号: `3  4  5  8  8  2  8  6  5`
桁の名称: `d9 d8 d7 d6 d5 d4 d3 d2 d1`

チェックサムの計算:
`(d1 + 2*d2 + 3*d3 + ... + 9*d9) mod 11 = 0`

そこで今度は、与えられた番号に対してチェックサムを計算し、それが有効な口座番号かどうかを識別するコードも書く必要があります。

=== ユーザー・ストーリー 3

あなたの上司は、あなたの成果をぜひ見たいと考えています。彼は、インプットファイルごとに、調査結果を以下のフォーマットでファイルに書き出すよう依頼してきました。

[source, txt]
----
457508000
664371495 ERR
86110??36 ILL
----

つまり、ファイルは1行に1つの口座番号を持ちます。一部の文字が判読不能な場合は、`?`で置き換えられます。チェックサムが間違っている場合や、番号が判読不能な場合は、ステータスを示す2列目にその旨が記載されます。

=== ユーザー・ストーリー 4

調査の結果、番号がERR（エラー）やILL（判読不能）と判定されるのは、スキャナがいずれかの数字のパイプまたはアンダースコアを1つだけ読み取り損ねたことが原因である場合が多いと判明しました。例えば、

[source, txt]
----
    _  _  _  _  _  _     _ 
|_||_|| || ||_   |  |  ||_ 
  | _||_||_||_|  |  |  | _|
----

もしスキャナが `|` を1つ見逃していたら、`9` は `8` になったかもしれません。あるいは、`0` が `8` になることもあり得ます。`1` は `7` になるかもしれません。`5` は `9` や `6` になる可能性があります。そこであなたの次のタスクは、ERRやILLと判定された番号を調査し、パイプかアンダースコアを1つだけ追加または削除することで、本来あるべき数値を推測することです。有効なチェックサムを持つ可能性のある番号が1つだけ存在する場合は、その番号を使用します。選択肢が複数ある場合は、ステータスを `AMB`（Ambiguous）とします。それでもまだ本来の数値を特定できない場合は、ステータスを `ILL` として報告する必要があります。



== ヒント

コード内で3行3列のセルを書き出して、それが識別可能な数字を形成するようにする方法を見つけることをお勧めします。たとえあなたのコードが内部的にそのように表現していなくてもです。私なら、

`"   |_|  |"`

よりも、

[source, txt]
----
"   " +
"|_|" +
"  |"
----

と書かれている方が、ずっと読みやすいです。

ChristopheとEmmanuelがXP2005でこの「カタ」を発表した際、彼らは反復（iteration）ではなく再帰（recursion）を多用したソリューションに取り組みました。多くの人は再帰よりも反復の方が馴染みやすいでしょう。このカタを両方の方法で試してみてください。

== 避けるべき落とし穴

  * チェックサムの定義をよく注意して読んでください。これは単純な内積ではなく、桁の順序が期待とは逆になっています。
  * 仕様書には、パイプやアンダースコアを1つ追加・削除した場合に、有効な数字となりうる全ての代替パターンがリストアップされているわけではありません。
  * `?`（判読不能文字）に対しても、パイプやアンダースコアを1つ追加・削除することで、本来あるべき数値を推測することを忘れないでください。

== テストケース

.use case 1
[source, txt]
----
 _  _  _  _  _  _  _  _  _ 
| || || || || || || || || |
|_||_||_||_||_||_||_||_||_|
                           
=> 000000000
                           
  |  |  |  |  |  |  |  |  |
  |  |  |  |  |  |  |  |  |
                           
=> 111111111
 _  _  _  _  _  _  _  _  _ 
 _| _| _| _| _| _| _| _| _|
|_ |_ |_ |_ |_ |_ |_ |_ |_ 
                           
=> 222222222
 _  _  _  _  _  _  _  _  _ 
 _| _| _| _| _| _| _| _| _|
 _| _| _| _| _| _| _| _| _|
                           
=> 333333333
                           
|_||_||_||_||_||_||_||_||_|
  |  |  |  |  |  |  |  |  |
                           
=> 444444444
 _  _  _  _  _  _  _  _  _ 
|_ |_ |_ |_ |_ |_ |_ |_ |_ 
 _| _| _| _| _| _| _| _| _|
                           
=> 555555555
 _  _  _  _  _  _  _  _  _ 
|_ |_ |_ |_ |_ |_ |_ |_ |_ 
|_||_||_||_||_||_||_||_||_|
                           
=> 666666666
 _  _  _  _  _  _  _  _  _ 
  |  |  |  |  |  |  |  |  |
  |  |  |  |  |  |  |  |  |
                           
=> 777777777
 _  _  _  _  _  _  _  _  _ 
|_||_||_||_||_||_||_||_||_|
|_||_||_||_||_||_||_||_||_|
                           
=> 888888888
 _  _  _  _  _  _  _  _  _ 
|_||_||_||_||_||_||_||_||_|
 _| _| _| _| _| _| _| _| _|
                           
=> 999999999
    _  _     _  _  _  _  _ 
  | _| _||_||_ |_   ||_||_|
  ||_  _|  | _||_|  ||_| _|
                           
=> 123456789
----

.use case 3
[source, txt]
----
 _  _  _  _  _  _  _  _    
| || || || || || || ||_   |
|_||_||_||_||_||_||_| _|  |
                           
=> 000000051
    _  _  _  _  _  _     _ 
|_||_|| || ||_   |  |  | _ 
  | _||_||_||_|  |  |  | _|
                           
=> 49006771? ILL
    _  _     _  _  _  _  _ 
  | _| _||_| _ |_   ||_||_|
  ||_  _|  | _||_|  ||_| _ 
                           
=> 1234?678? ILL
----

.use case 4
[source, txt]
----
                          
  |  |  |  |  |  |  |  |  |
  |  |  |  |  |  |  |  |  |
                           
=> 711111111
 _  _  _  _  _  _  _  _  _ 
  |  |  |  |  |  |  |  |  |
  |  |  |  |  |  |  |  |  |
                           
=> 777777177
 _  _  _  _  _  _  _  _  _ 
 _|| || || || || || || || |
|_ |_||_||_||_||_||_||_||_|
                           
=> 200800000
 _  _  _  _  _  _  _  _  _ 
 _| _| _| _| _| _| _| _| _|
 _| _| _| _| _| _| _| _| _|
                           
=> 333393333 
 _  _  _  _  _  _  _  _  _ 
|_||_||_||_||_||_||_||_||_|
|_||_||_||_||_||_||_||_||_|
                           
=> 888888888 AMB ['888886888', '888888880', '888888988']
 _  _  _  _  _  _  _  _  _ 
|_ |_ |_ |_ |_ |_ |_ |_ |_ 
 _| _| _| _| _| _| _| _| _|
                           
=> 555555555 AMB ['555655555', '559555555']
 _  _  _  _  _  _  _  _  _ 
|_ |_ |_ |_ |_ |_ |_ |_ |_ 
|_||_||_||_||_||_||_||_||_|
                           
=> 666666666 AMB ['666566666', '686666666']
 _  _  _  _  _  _  _  _  _ 
|_||_||_||_||_||_||_||_||_|
 _| _| _| _| _| _| _| _| _|
                           
=> 999999999 AMB ['899999999', '993999999', '999959999']
    _  _  _  _  _  _     _ 
|_||_|| || ||_   |  |  ||_ 
  | _||_||_||_|  |  |  | _|
                           
=> 490067715 AMB ['490067115', '490067719', '490867715']
    _  _     _  _  _  _  _ 
 _| _| _||_||_ |_   ||_||_|
  ||_  _|  | _||_|  ||_| _|
                           
=> 123456789
 _     _  _  _  _  _  _    
| || || || || || || ||_   |
|_||_||_||_||_||_||_| _|  |
                           
=> 000000051
    _  _  _  _  _  _     _ 
|_||_|| ||_||_   |  |  | _ 
  | _||_||_||_|  |  |  | _|
                           
=> 490867715 
----

---

[[sample_code_0]]
.テキスト折り畳みのタイトル
[%collapsible] 
====
[source, rust]
----

----
====

[[sample_code_0]]
.テキスト折り畳みのタイトル
[%collapsible] 
====
[source, rust]
----

----
====

.タイトル
[source,rust,indent=0]
----
include::[]
----

[cols="2a,4a,4a", options="header"]
.テーブルタイトル
|===
|カラム名1 |カラム名2 |カラム名3 

|セル11
|セル12
|セル13

|セル21
|セル22
|セル23
|===

[cols="2a,2a", options="header"]
.test
|===
|カラム|カラム2

|
|
下記のような特徴があります。:

* 標準仕様準拠
* 高パフォーマンス
* 高い可搬性

http://getfirefox.com[Firefoxをダウンロードする]
|===


.テスト
[#image_tag]
image::.png[]


.テスト
[#image_tag]
image::.png[,500]


---


[red]##*軽量マークアップ言語*##

[.underline]#コア#